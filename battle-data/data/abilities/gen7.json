{
  "stamina": { "name": "Stamina", "flags": [] },
  "wimpout": {
    "name": "Wimp Out",
    "flags": [],
    "effect": {
      "delegates": ["ability:emergencyexit"]
    }
  },
  "emergencyexit": {
    "name": "Emergency Exit",
    "flags": [],
    "effect": {
      "callbacks": {
        "on_after_damage": [
          "# Move damage is handled together after secondary effects.",
          "if $effect.is_move or $effect.id == confusion:",
          ["return"],
          "$original_hp = $target.hp + $damage",
          "activate_ability: $original_hp"
        ],
        "on_after_move_secondary_effects_damage": [
          "if $damage == 0:",
          ["return"],
          "activate_ability: $original_hp"
        ],
        "on_activate": {
          "metadata": {
            "parameters": ["original_hp"]
          },
          "program": [
            "if !$original_hp or $battle.ending or !func_call(can_switch: $target.player):",
            ["return"],
            "if $target.hp == 0 or $target.force_switch or $target.needs_switch or $target.is_away_from_field:",
            ["return"],
            "$half = $target.max_hp / 2",
            "if $original_hp > $half and $target.hp <= $half:",
            [
              "foreach $mon in func_call(all_active_mons):",
              ["set_needs_switch: $mon false"],
              "log_activate: with_target",
              "switch_out: $target"
            ]
          ]
        }
      }
    }
  },
  "watercompaction": { "name": "Water Compaction", "flags": [] },
  "merciless": { "name": "Merciless", "flags": [] },
  "shieldsdown": { "name": "Shields Down", "flags": ["Permanent"] },
  "stakeout": { "name": "Stakeout", "flags": [] },
  "waterbubble": { "name": "Water Bubble", "flags": [] },
  "steelworker": { "name": "Steelworker", "flags": [] },
  "berserk": { "name": "Berserk", "flags": [] },
  "slushrush": { "name": "Slush Rush", "flags": [] },
  "longreach": { "name": "Long Reach", "flags": [] },
  "liquidvoice": { "name": "Liquid Voice", "flags": [] },
  "triage": { "name": "Triage", "flags": [] },
  "galvanize": { "name": "Galvanize", "flags": [] },
  "surgesurfer": { "name": "Surge Surfer", "flags": [] },
  "schooling": { "name": "Schooling", "flags": ["Permanent"] },
  "disguise": { "name": "Disguise", "flags": ["Permanent"] },
  "battlebond": { "name": "Battle Bond", "flags": ["Permanent"] },
  "powerconstruct": { "name": "Power Construct", "flags": ["Permanent"] },
  "corrosion": { "name": "Corrosion", "flags": [] },
  "comatose": {
    "name": "Comatose",
    "flags": ["Permanent"],
    "effect": {
      "callbacks": {
        "is_asleep": ["return true"]
      }
    }
  },
  "queenlymajesty": { "name": "Queenly Majesty", "flags": [] },
  "innardsout": { "name": "Innards Out", "flags": [] },
  "dancer": {
    "name": "Dancer",
    "flags": [],
    "effect": {
      "callbacks": {
        "on_start": ["add_pseudo_weather: $this.id"],
        "on_end": [
          "# If no other Mons have this ability on the field, remove the pseudo-weather.",
          "foreach $other in func_call(all_active_mons):",
          [
            "if $other != $target and func_call(has_ability: $other $this.id):",
            ["return"]
          ],
          "remove_pseudo_weather: $this.id"
        ]
      }
    },
    "condition": {
      "callbacks": {
        "on_after_move": [
          "if !func_call(move_has_flag: $move dance) or !$success or $move.external:",
          ["return"],
          "$dancers = []",
          "foreach $mon in func_call(reverse: func_call(all_active_mons_in_speed_order_and_ability_effect_order)):",
          [
            "if $mon == $user:",
            ["continue"],
            "if func_call(has_ability: $mon $this.id) and !$mon.is_semi_invulnerable:",
            ["$dancers = func_call(append: $dancers $mon)"]
          ],
          "foreach $dancer in $dancers:",
          [
            "faint_messages",
            "if $battle.ending:",
            ["return"],
            "if $dancer.fainted:",
            ["return"],
            "log_activate: with_target $dancer",
            "if func_call(is_ally: $dancer $user):",
            ["$move_target = $target"],
            "else:",
            ["$move_target = $user"],
            "$dancer_move = func_call(new_active_move: $move.id $dancer)",
            "use_active_move: $dancer $dancer_move $move_target use_effect_as_source_effect preventable"
          ]
        ]
      }
    }
  },
  "battery": { "name": "Battery", "flags": [] },
  "fluffy": { "name": "Fluffy", "flags": [] },
  "dazzling": { "name": "Dazzling", "flags": [] },
  "soulheart": { "name": "Soul-Heart", "flags": [] },
  "tanglinghair": { "name": "Tangling Hair", "flags": [] },
  "receiver": { "name": "Receiver", "flags": [] },
  "powerofalchemy": { "name": "Power of Alchemy", "flags": [] },
  "beastboost": { "name": "Beast Boost", "flags": [] },
  "rkssystem": { "name": "RKS System", "flags": ["Permanent"] },
  "electricsurge": { "name": "Electric Surge", "flags": [] },
  "psychicsurge": { "name": "Psychic Surge", "flags": [] },
  "mistysurge": { "name": "Misty Surge", "flags": [] },
  "grassysurge": { "name": "Grassy Surge", "flags": [] },
  "fullmetalbody": { "name": "Full Metal Body", "flags": [] },
  "shadowshield": { "name": "Shadow Shield", "flags": [] },
  "prismarmor": { "name": "Prism Armor", "flags": [] },
  "neuroforce": { "name": "Neuroforce", "flags": [] }
}
